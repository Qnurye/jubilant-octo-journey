
# 产品需求文档 (PRD)

## 1. 项目背景与目标

### 1.1 背景

当前学科竞赛（如 ACM、数学建模）教学存在“评估过重、支持不足”的问题。现有的 OJ 平台（LeetCode 等）侧重于排名和结果反馈，导致学生在遇到困难时缺乏即时的、非评判性的引导，容易产生焦虑和挫败感。同时，教师缺乏工具去了解学生的思维瓶颈，只能看到最终的通过率。

### 1.2 产品目标

构建一个垂直领域的智能问答系统，旨在：

1. **去风险化学习 (De-risking):** 为学生提供即时、私密、准确的知识点解答，缓解竞争压力。
2. **增强准确性:** 利用 **混合 RAG (向量+知识图谱)** 技术，解决大模型在算法和数学领域的幻觉问题。
3. **教学洞察:** 通过分析学生的提问数据，为教师提供“形成性评价”依据，识别学生的知识盲区。

---

## 2. 用户角色 (User Personas)

| 角色 | 描述 | 核心需求 |
| --- | --- | --- |
| **学生 (竞赛选手)** | 正在准备算法竞赛或数学建模的学生。 | 1. 遇到复杂概念（如 Dijkstra vs A*）能迅速得到解释。<br>

<br>2. 回答需要有代码示例，且代码可读性高。<br>

<br>3. 希望系统准确，不要瞎编乱造。 |
| **教师 (教练)** | 负责指导竞赛的指导老师。 | 1. 想知道学生最近都在问什么（哪里卡住了）。<br>

<br>2. 想看到可视化的知识点掌握热力图。<br>

<br>3. 不需要看具体的聊天记录，但需要看聚合数据。 |

---

## 3. 功能需求说明 (Functional Requirements)

### 3.1 核心模块一：智能问答端 (Student Side)

#### FR-S-01: 竞赛知识问答

* **优先级:** P0 (最高)
* **描述:** 用户通过自然语言输入问题，系统返回基于知识库的答案。
* **逻辑流程:**
1. 输入预处理（意图识别）。
2. **混合检索 (Hybrid Retrieval):**
* 并行执行向量检索 (Milvus) 获取文档片段。
* 并行执行图谱检索 (Neo4j) 获取实体关系（如算法的前置知识）。


3. 重排序 (Re-ranking) 筛选 Top-K 证据。
4. LLM (Qwen 3) 生成答案。


* **验收标准:**
* 对于事实性问题（如“什么是动态规划”），响应需包含准确定义。
* 对于关系型问题（如“贪心和DP的区别”），响应需利用图谱信息进行对比。
* 所有回答必须基于检索到的上下文，而非模型幻觉。



#### FR-S-02: 代码块交互优化

* **优先级:** P1
* **描述:** 针对大模型生成的代码块，提供更好的阅读和交互体验。
* **细分功能:**
* **语法高亮:** 自动检测代码语言（C++, Python, Java 等）并高亮。
* **语言手动切换 (特定需求):** 在代码框头部提供下拉菜单。如果 LLM 自动检测的语言错误（例如把 C++ 识别为 C），用户可手动修正，强制重新渲染高亮。
* **一键复制:** 代码框右上角提供复制按钮。



#### FR-S-03: 引文溯源 (Citation)

* **优先级:** P2
* **描述:** 在生成的答案下方，列出参考的知识来源（如：“参考自《算法导论》第 3 章”或“基于题目 2023-MCM-B 题解”）。
* **目的:** 增加可信度。

---

### 3.2 核心模块二：教师仪表盘 (Teacher Side)

#### FR-T-01: 易错概念热点图 (Misconception Hotspots)

* **优先级:** P1
* **描述:** 通过对学生提问进行聚类分析，展示当前的高频困惑点。
* **可视化:** 词云图 (Word Cloud) 或 气泡图。
* **示例:** 如果多名学生问了“递归溢出”，该词条应高亮显示。

#### FR-T-02: 知识图谱覆盖率 (Topic Progress)

* **优先级:** P1
* **描述:** 将学生的问题映射到预定义的学科知识图谱上。
* **可视化:** 力导向图或树图 (Treemap)。
* **逻辑:** 知识点节点颜色深浅代表提问频率。红色节点表示“重灾区”（学生频繁提问，说明掌握度低）。

#### FR-T-03: 提问趋势分析

* **优先级:** P2
* **描述:** 展示特定时间段内的提问活跃度。
* **可视化:** 折线图 (Line Chart)。

---

### 3.3 后台管理与数据处理 (Admin/System)

#### FR-A-01: 多源异构数据 ETL

* **优先级:** P0
* **描述:** 能够处理不同格式的上传文件。
* **支持格式:** PDF (论文/教材), Markdown (题解)。
* **关键技术:**
* **内容感知切分 (Content-Aware Chunking):** 识别代码块不被截断，识别表格不被打散。
* **三元组提取:** 利用 LLM 自动从文本中提取 `(Entity, Relation, Entity)` 存入 Neo4j。



---

## 4. 非功能需求 (Non-Functional Requirements)

### 4.1 性能要求

* **响应时间:** 问答生成的首字延迟 (TTFT) 应小于 3 秒（依赖于 GPU 性能，建议使用 vLLM 或 TGI 加速推理）。
* **并发:** 系统需支持至少 10-20 人并发使用（班级规模测试）。

### 4.2 准确性 (Robustness)

* **抗幻觉:** 回答中引用的公式、算法步骤必须与知识库一致。
* **中间迷失:** 上下文窗口限制下，通过重排序 (Re-ranker) 确保关键信息在 Prompt 的前部或后部，避免 LLM 忽略中间信息。

### 4.3 技术栈约束

* **LLM:** Qwen/Qwen3-32B, Qwen/Qwen3-Embedding-8B, Qwen/Qwen3-Reranker-4B
* **RAG 框架:** LlamaIndex
* **向量库:** Milvus
* **图数据库:** Neo4j
* **前端:** Next.js + Tailwind + shadcn/ui + TanStack Query
* **后端:** Bun + Hono + Drizzle ORM
